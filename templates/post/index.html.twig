{% extends 'base.html.twig' %}

{% block body %}
	{% for post in posts %}
		<div class="card mb-2">
			<div class="card-body">
				<h5 class="card-title">{{ post.title }}</h5>
				<p class="card-text">{{ post.message | raw }}</p>
				<a href="#" onclick="likePost({{ post.id }})" class="card-link text-decoration-none text-dark"><i
							class="bi bi-hand-thumbs-up"></i>: {{ post.likes }} like
					this</a>
				<hr >
				<small>
					{% for comment in post.comments %}
						{{ comment.message }} by {{ comment.author }} <br>
					{% endfor %}
				</small>
				<hr >
				<a href="{{ path('post_details', {id: post.id}) }}" class="btn btn-info">Show details</a>
				<a href="{{ path('post_edit', {id: post.id}) }}" class="btn btn-warning">EDIT</a>
			</div>
		</div>
	{% endfor %}

	<script>
		function likePost(id) {
			let form = new FormData();
			form.append('id', id);
			const options = {
				method: 'POST',
				body: form
			}
			fetch('{{ path("api_post_likes") }}', options)
				.then((rd) => {
					rd.json().then((data) => {
						console.log(data);
						location.reload();
					})
				}).catch((err) => {
				console.log(err);
			});
		}
	</script>
{% endblock %}
